<!-- æ— éšœç¢æ”¯æŒï¼šå±å¹•é˜…è¯»å™¨çŠ¶æ€é€šçŸ¥åŒºåŸŸ -->
<view aria-live="polite" aria-atomic="true" class="sr-only">
  <block wx:if="{{loading}}">æ­£åœ¨ç”Ÿæˆç¥ç¦è¯­ï¼Œè¯·ç¨å€™...</block>
  <block wx:elif="{{error}}">é”™è¯¯ï¼š{{error}}</block>
  <block wx:elif="{{copySuccess}}">ç¥ç¦è¯­å·²æˆåŠŸå¤åˆ¶åˆ°å‰ªè´´æ¿</block>
  <block wx:elif="{{blessing && !loading && !error}}">ç¥ç¦è¯­ç”Ÿæˆå®Œæˆ</block>
</view>

<!-- ä¸»å†…å®¹åŒºåŸŸï¼šå“åº”å¼ä¸¤åˆ—å¸ƒå±€ -->
<view class="container">
  <!-- å·¦ä¾§ï¼šè¡¨å•è¾“å…¥åŒºåŸŸ -->
  <view class="form-section card-primary form-column">
    <!-- è£…é¥°å…ƒç´  -->
    <view class="decoration-tr"></view>

    <!-- æ¨¡å¼é€‰æ‹© -->
    <view class="mode-selector text-center mb-6">
      <view class="title festive-title">
        <text decode="{{true}}">ğŸ¤– æ™ºèƒ½ç¥ç¦ç”Ÿæˆå™¨ âœ¨</text>
      </view>

      <view class="mode-buttons">
        <button
          class="btn-mode {{!formData.useSmartMode ? 'btn-mode-active btn-template-active' : 'btn-mode-inactive'}}"
          bindtap="toggleMode"
          data-mode="template"
        >
          ğŸ¯ å¿«é€Ÿæ¨¡æ¿
        </button>
        <button
          class="btn-mode {{formData.useSmartMode ? 'btn-mode-active btn-smart-active' : 'btn-mode-inactive'}}"
          bindtap="toggleMode"
          data-mode="smart"
        >
          ğŸ’¬ æ™ºèƒ½æè¿°
        </button>
      </view>
    </view>

    <form bindsubmit="onSubmit" class="form-content">
      <!-- æ™ºèƒ½æ¨¡å¼è¡¨å• -->
      <view wx:if="{{formData.useSmartMode}}" class="mode-content">
        <view class="input-group">
          <label class="input-label">è¯·è¾“å…¥ç¥ç¦è¯­æè¿°</label>
          <textarea
            class="textarea-input"
            placeholder="ä¾‹å¦‚ï¼šæ˜å¤©æ˜¯æˆ‘æœ€å¥½çš„æœ‹å‹å°æ˜çš„ç”Ÿæ—¥ï¼Œä»–æœ€è¿‘å·¥ä½œå¾ˆè¾›è‹¦ï¼Œæƒ³ç»™ä»–ä¸€ä¸ªæ¸©æš–çš„ç”Ÿæ—¥ç¥ç¦..."
            value="{{formData.customDescription}}"
            bindinput="onInputChange"
            data-field="customDescription"
            maxlength="300"
          ></textarea>
          <view class="char-count">{{formData.customDescription.length}}/300</view>
        </view>
      </view>

      <!-- ç»å…¸æ¨¡æ¿æ¨¡å¼è¡¨å• -->
      <view wx:else class="mode-content">
        <view class="input-group">
          <label class="input-label">ç¥ç¦åœºæ™¯ *</label>
          <picker
            mode="selector"
            range="{{scenarios}}"
            range-key="label"
            value="{{scenarioIndex}}"
            bindchange="onScenarioChange"
          >
            <view class="picker-input {{formData.scenario ? '' : 'placeholder'}}">
              {{formData.scenario ? scenarios[scenarioIndex].label : 'è¯·é€‰æ‹©ç¥ç¦åœºæ™¯'}}
            </view>
          </picker>
        </view>

        <view class="input-group">
          <label class="input-label">èŠ‚æ—¥ç±»å‹</label>
          <picker
            mode="selector"
            range="{{festivals}}"
            range-key="label"
            value="{{festivalIndex}}"
            bindchange="onFestivalChange"
          >
            <view class="picker-input {{formData.festival ? '' : 'placeholder'}}">
              {{formData.festival ? festivals[festivalIndex].label : 'æ— ç‰¹å®šèŠ‚æ—¥'}}
            </view>
          </picker>
        </view>

        <view class="input-group">
          <label class="input-label">ç›®æ ‡äººç¾¤ *</label>
          <picker
            mode="selector"
            range="{{targetPersons}}"
            range-key="label"
            value="{{targetPersonIndex}}"
            bindchange="onTargetPersonChange"
          >
            <view class="picker-input {{formData.targetPerson ? '' : 'placeholder'}}">
              {{formData.targetPerson ? targetPersons[targetPersonIndex].label : 'è¯·é€‰æ‹©ç›®æ ‡äººç¾¤'}}
            </view>
          </picker>
        </view>

        <view class="input-group">
          <label class="input-label">ç¥ç¦é£æ ¼</label>
          <picker
            mode="selector"
            range="{{styles}}"
            range-key="label"
            value="{{styleIndex}}"
            bindchange="onStyleChange"
          >
            <view class="picker-input">
              {{formData.style ? styles[styleIndex].label : 'æ¸©é¦¨äº²åˆ‡'}}
            </view>
          </picker>
        </view>
      </view>

      <!-- ç”ŸæˆæŒ‰é’® -->
      <view class="generate-button-container">
        <button
          class="btn-generate {{loading ? 'loading' : ''}}"
          form-type="submit"
          disabled="{{loading || (!formData.useSmartMode && (!formData.scenario || !formData.targetPerson)) || (formData.useSmartMode && (!formData.customDescription || !formData.customDescription.trim()))}}"
        >
          <view class="button-content">
            <block wx:if="{{loading}}">
              <view class="loading-spinner"></view>
              <text>{{formData.useSmartMode ? 'ğŸ§  AIæ€è€ƒä¸­...' : 'ğŸŠ ç”Ÿæˆä¸­ï¼Œè¯·ç¨å€™...'}}</text>
            </block>
            <block wx:else>
              <text>{{formData.useSmartMode ? 'ğŸ§  æ™ºèƒ½ç”Ÿæˆ' : 'âœ¨ å¿«é€Ÿç”Ÿæˆ'}}</text>
            </block>
          </view>
        </button>
      </view>
    </form>
  </view>

  <!-- å³ä¾§ï¼šç»“æœå±•ç¤ºåŒºåŸŸ -->
  <view class="result-section result-column">
    <view wx:if="{{error}}" class="error-container">
      <view class="error-message">
        âŒ {{error}}
      </view>
    </view>

    <view wx:elif="{{blessing}}" class="result-container card-secondary">
      <view class="result-header">
        <text class="result-title">ğŸ‰ ç”Ÿæˆçš„ç¥ç¦è¯­</text>
        <view class="result-actions">
          <button class="action-btn" bindtap="onCopy">
            <text decode="{{true}}">ğŸ“‹ å¤åˆ¶</text>
          </button>
          <button class="action-btn" bindtap="onRegenerate">
            <text decode="{{true}}">ğŸ”„ é‡æ–°ç”Ÿæˆ</text>
          </button>
        </view>
      </view>

      <view class="blessing-content">
        {{blessing}}
      </view>

      <!-- å¤åˆ¶æˆåŠŸæç¤º -->
      <view wx:if="{{copySuccess}}" class="copy-success {{copyFading ? 'fade-out' : ''}}">
        âœ… å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼
      </view>
    </view>

    <view wx:else class="empty-state">
      <view class="empty-icon">ğŸ™</view>
      <view class="empty-text">è¯·è¾“å…¥ç›¸å…³ä¿¡æ¯ç”Ÿæˆç¥ç¦è¯­</view>
    </view>
  </view>
</view>